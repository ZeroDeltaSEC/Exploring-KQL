57let sqlInjectionPatterns = dynamic([
    "' or '1'='1",
    "' OR 1=1 --",
    "'; DROP TABLE",
    "'; EXEC",
    "' UNION SELECT",
    "'--",
    "' OR 'a'='a",
    "' or 1=1--",
    "' or 1=1#",
    "' or 1=1/*"
]);
// Example for SigninLogs (Azure AD/Entra ID logs)
SigninLogs
| where TimeGenerated >= ago(7d)
| where UserPrincipalName has_any(sqlInjectionPatterns) or Identity has_any(sqlInjectionPatterns)
| project TimeGenerated, UserPrincipalName, Identity, IPAddress, AppDisplayName, ResourceDisplayName, ConditionalAccessStatus

let sqlInjectionPatterns = dynamic([
    "' or '1'='1",
    "' OR 1=1 --",
    "'; DROP TABLE",
    "'; EXEC",
    "' UNION SELECT",
    "'--",
    "' OR 'a'='a",
    "' or 1=1--",
    "' or 1=1#",
    "' or 1=1/*"
]);
search *
| where TimeGenerated >= ago(7d)
| where tostring(parse_json(tostring(*))) has_any(sqlInjectionPatterns)
| project TimeGenerated, SourceTable, _ResourceId, Computer, IPAddress, Account, _RawData = *

let sqlInjectionPatterns = dynamic([
    "' or '1'='1",
    "' OR 1=1 --",
    "'; DROP TABLE",
    "'; EXEC",
    "' UNION SELECT",
    "'--",
    "' OR 'a'='a",
    "' or 1=1--",
    "' or 1=1#",
    "' or 1=1/*"
]);
search *
| where TimeGenerated >= ago(7d)
| where * has_any(sqlInjectionPatterns)
// | project TimeGenerated, SourceTable, _ResourceId, Computer, IPAddress, Account, EventData = *


let sqlInjectionPatterns = dynamic([
  "' or '1'='1",
  "-- OR 1=1 --",
  "; DROP TABLE",
  "EXEC",
  "UNION SELECT",
  "--a",
  "OR 'a'='a",
  "or 1=1--",
  "or 1=1#",
  "or 1=1/*"
]);

search *
| where TimeGenerated >= ago(7d)
| where * has_any(sqlInjectionPatterns)

let sqlInjectionPatterns = dynamic([
    "' or '1'='1'",
    "-- OR 1=1 --",
    "; DROP TABLE",
    "EXEC",
    "UNION SELECT",
    "--a",
    "OR 'a'='a'",
    "or 1=1--",
    "or 1=1#",
    "or 1=1/*"
]);
search in (*)
| where TimeGenerated >= ago(7d)
| where tostring(*) has_any sqlInjectionPatterns


search 
  "or '1'='1" or
  "-- OR 1=1 --" or
  "; DROP TABLE" or
  "EXEC" or
  "UNION SELECT" or
  "--a" or
  "OR 'a'='a" or
  "or 1=1--" or
  "or 1=1#" or
  "or 1=1/*"
| where TimeGenerated >= ago(7d)

defender

let sqlInjectionPatterns = dynamic([
    "or '1'='1",
    "-- OR 1=1 --",
    "; DROP TABLE",
    "EXEC",
    "UNION SELECT",
    "--a",
    "OR 'a'='a",
    "or 1=1--",
    "or 1=1#",
    "or 1=1/*"
]);

union 
    DeviceNetworkEvents,
    DeviceWebTrafficEvents,
    DeviceFileEvents,
    DeviceProcessEvents
| where Timestamp >= ago(7d)
| where
    RemoteUrl has_any(sqlInjectionPatterns)
    or InitiatingProcessCommandLine has_any(sqlInjectionPatterns)
    or AdditionalFields has_any(sqlInjectionPatterns)
    or RawEventData has_any(sqlInjectionPatterns)
| project Timestamp, DeviceName, RemoteUrl, InitiatingProcessCommandLine, AdditionalFields
| order by Timestamp desc

search in (DeviceEvents, DeviceNetworkEvents, DeviceWebTrafficEvents, DeviceFileEvents)
    "or '1'='1"
    or "-- OR 1=1 --"
    or "; DROP TABLE"
    or "EXEC"
    or "UNION SELECT"
    or "--a"
    or "OR 'a'='a"
    or "or 1=1--"
    or "or 1=1#"
    or "or 1=1/*"
| where Timestamp >= ago(7d)
| project Timestamp, DeviceName, DeviceId
| order by Timestamp desc

let UnlockEvents = SecurityEvent
    | where EventID == 4767
    | summarize arg_max(TimeGenerated, *) by TargetUserName
    | extend UnlockTime = TimeGenerated;
SecurityEvent
| where EventID == 4740
| summarize arg_max(TimeGenerated, *) by TargetUserName
| extend LockoutTime = TimeGenerated
| join kind=leftouter UnlockEvents on TargetUserName
| where isnull(UnlockTime) or LockoutTime > UnlockTime
| project TargetUserName, LockoutTime, UnlockTime
| sort by TargetUserName asc

SecurityEvent
| where EventID == 4740 // Lockout event
| where TargetUserName == "123654" and Computer contains "ge32145"
| project TimeGenerated, TargetUserName, Computer, AccountDomain, EventData
| sort by TimeGenerated desc


let googleCIDRs = dynamic([
  "64.18.0.0/20","64.233.160.0/19","66.102.0.0/20","66.249.80.0/20",
  "72.14.192.0/18","74.125.0.0/16","108.177.8.0/21",
  "173.194.0.0/16","209.85.128.0/17","216.58.192.0/19","216.239.32.0/19"]);
EmailEvents
| where Timestamp > ago(7d)
| where AuthenticationDetails has "dkim=pass" and AuthenticationDetails has "header.d=accounts.google.com"
| where not(
        ipv4_is_match(SenderIPv4, googleCIDRs[0]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[1]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[2]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[3]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[4]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[5]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[6]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[7]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[8]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[9]) or
        ipv4_is_match(SenderIPv4, googleCIDRs[10])
     )
| project Timestamp, SenderFromAddress, SenderIPv4, RecipientEmailAddress,
          Subject, AuthenticationDetails, NetworkMessageId