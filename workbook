Ah, înțeleg! Vrei să generezi un text formatat gata pentru copy-paste care să arate exact ca în poza. Îți voi arăta cum să creezi un query KQL care să producă textul formatat.
Query pentru generarea textului formatat
kqllet MessageID = "1234xyz";
EmailEvents
| where NetworkMessageId == MessageID
| join kind=leftouter (
    EmailAttachmentInfo
    | where NetworkMessageId == MessageID
    | summarize AttachmentCount = count()
) on NetworkMessageId
| join kind=leftouter (
    EmailUrlInfo
    | where NetworkMessageId == MessageID  
    | summarize URLCount = count()
) on NetworkMessageId
| extend 
    AuthDetails = parse_json(AuthenticationDetails),
    SPF_Result = iif(isempty(tostring(parse_json(AuthenticationDetails).SPF)), "unset", tostring(parse_json(AuthenticationDetails).SPF)),
    DKIM_Result = iif(isempty(tostring(parse_json(AuthenticationDetails).DKIM)), "unset", tostring(parse_json(AuthenticationDetails).DKIM)),
    DMARC_Result = iif(isempty(tostring(parse_json(AuthenticationDetails).DMARC)), "unset", tostring(parse_json(AuthenticationDetails).DMARC)),
    CompAuth_Result = iif(isempty(tostring(parse_json(AuthenticationDetails).CompAuth)), "unset", tostring(parse_json(AuthenticationDetails).CompAuth)),
    AttCount = iif(isempty(AttachmentCount), 0, AttachmentCount),
    UrlCount = iif(isempty(URLCount), 0, URLCount)
| project FormattedReport = strcat(
    "Email Analysis Report\n\n",
    "🕐 Time: ", format_datetime(TimeGenerated, "yyyy-MM-dd HH:mm:ss"), "\n",
    "👤 Sender: ", SenderFromAddress, " (", SenderFromAddress, ")\n", 
    "📧 Recipient: ", RecipientEmailAddress, "\n",
    "🌐 Sender IP: ", SenderIPv4, "\n\n",
    "🔐 Authentication:\n",
    "• SPF: ", SPF_Result, "\n",
    "• DKIM: ", DKIM_Result, "\n", 
    "• DMARC: ", DMARC_Result, "\n",
    "• CompAuth: ", CompAuth_Result, "\n\n",
    "📎 Attachments: ", AttCount, "\n",
    "🔗 URL Count: ", UrlCount, "\n\n",
    "📦 Delivery: ", DeliveryAction, "\n",
    "📋 Subject: ", Subject, "\n"
)
| project-away NetworkMessageId1, URLCount, AttachmentCount
Alternativă cu format exact ca în poză
kqllet MessageID = "1234xyz";
EmailEvents
| where NetworkMessageId == MessageID
| join kind=leftouter (
    EmailAttachmentInfo
    | where NetworkMessageId == MessageID
    | summarize AttachmentCount = count()
) on NetworkMessageId
| join kind=leftouter (
    EmailUrlInfo
    | where NetworkMessageId == MessageID  
    | summarize URLCount = count()
) on NetworkMessageId
| extend 
    SPF_Status = iif(isempty(tostring(parse_json(AuthenticationDetails).SPF)), "unset", tostring(parse_json(AuthenticationDetails).SPF)),
    DKIM_Status = iif(isempty(tostring(parse_json(AuthenticationDetails).DKIM)), "unset", tostring(parse_json(AuthenticationDetails).DKIM)),
    DMARC_Status = iif(isempty(tostring(parse_json(AuthenticationDetails).DMARC)), "unset", tostring(parse_json(AuthenticationDetails).DMARC)),
    CompAuth_Status = iif(isempty(tostring(parse_json(AuthenticationDetails).CompAuth)), "unset", tostring(parse_json(AuthenticationDetails).CompAuth))
| extend CopyPasteText = strcat(
    "Email Analysis Report\n",
    "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n",
    "🕐 Time: ", format_datetime(TimeGenerated, "yyyy-MM-dd HH:mm:ss"), "\n",
    "👤 Sender: ", SenderFromAddress, " (<", SenderFromAddress, ">)\n",
    "📧 Recipient: ", RecipientEmailAddress, "\n", 
    "🌐 Sender IP: ", SenderIPv4, "\n\n",
    "🔐 Authentication:\n",
    "   • SPF: ", SPF_Status, "\n",
    "   • DKIM: ", DKIM_Status, "\n",
    "   • DMARC: ", DMARC_Status, "\n", 
    "   • CompAuth: ", CompAuth_Status, "\n\n",
    "📎 Attachments: ", iif(isempty(AttachmentCount), "0", tostring(AttachmentCount)), "\n",
    "🔗 URL Count: ", iif(isempty(URLCount), "0", tostring(URLCount)), "\n\n",
    "📦 Delivery: ", DeliveryAction, "\n",
    "📋 Subject: ", Subject, "\n\n",
    "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
)
| project CopyPasteText
Cum să folosești în Workbook

Adaugă o celulă Query cu unul din query-urile de mai sus
Înlocuiește "1234xyz" cu parametrul {MessageID}
Setează vizualizarea la "Table"
Configurează tabla:

Ascunde header-ul
Setează coloana să ocupe toată lățimea
Activează word wrap pentru text lung



Query simplificat pentru test rapid
kqlEmailEvents
| where NetworkMessageId == "1234xyz"
| extend ReportText = strcat(
    "Time: ", TimeGenerated, "\n",
    "Sender: ", SenderFromAddress, "\n",
    "Recipient: ", RecipientEmailAddress, "\n", 
    "Sender IP: ", SenderIPv4, "\n",
    "Subject: ", Subject
)
| project ReportText
Rezultatul va fi un text formatat pe care îl poți selecta direct din rezultatul query-ului și da copy-paste. Textul va arăta exact ca în raportul din poza ta!
